<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSINT // COMMAND CENTER</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

    <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@100..800&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cyber: {
                            black: '#050505',
                            dark: '#0a0a0f',
                            panel: '#13131f',
                            border: '#2a2a35',
                            cyan: '#00f3ff',
                            amber: '#ffb800',
                            red: '#ff2a2a',
                            text: '#e0e0e0'
                        }
                    },
                    fontFamily: {
                        mono: ['"JetBrains Mono"', 'monospace'],
                        display: ['"Rajdhani"', 'sans-serif']
                    },
                    animation: {
                        'spin-slow': 'spin 3s linear infinite',
                        'pulse-fast': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'scanline': 'scanline 8s linear infinite',
                        'glitch': 'glitch 1s linear infinite',
                        'fade-in-up': 'fadeInUp 0.8s ease-out forwards',
                    },
                    keyframes: {
                        scanline: {
                            '0%': { transform: 'translateY(-100%)' },
                            '100%': { transform: 'translateY(100%)' }
                        },
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* BASE STYLES */
        body {
            background-color: #050505;
            background-image:
                radial-gradient(circle at 50% 50%, #111 0%, transparent 50%),
                linear-gradient(0deg, transparent 24%, rgba(0, 243, 255, .03) 25%, rgba(0, 243, 255, .03) 26%, transparent 27%, transparent 74%, rgba(0, 243, 255, .03) 75%, rgba(0, 243, 255, .03) 76%, transparent 77%, transparent),
                linear-gradient(90deg, transparent 24%, rgba(0, 243, 255, .03) 25%, rgba(0, 243, 255, .03) 26%, transparent 27%, transparent 74%, rgba(0, 243, 255, .03) 75%, rgba(0, 243, 255, .03) 76%, transparent 77%, transparent);
            background-size: 100% 100%, 50px 50px, 50px 50px;
            color: #e0e0e0;
            overflow-x: hidden;
        }

        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0a0a0f; }
        ::-webkit-scrollbar-thumb { background: #2a2a35; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #00f3ff; }

        /* NEON GLOW UTILS */
        .neon-border {
            box-shadow: 0 0 5px rgba(0, 243, 255, 0.2), inset 0 0 10px rgba(0, 243, 255, 0.1);
            border: 1px solid rgba(0, 243, 255, 0.3);
        }
        .neon-text { text-shadow: 0 0 5px rgba(0, 243, 255, 0.7); }
        .neon-amber { text-shadow: 0 0 5px rgba(255, 184, 0, 0.7); }
        .neon-red { text-shadow: 0 0 5px rgba(255, 42, 42, 0.7); }

        /* SCANNER LINE */
        .scan-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2));
            background-size: 100% 4px; z-index: 9999; opacity: 0.15;
        }

        /* GLITCH TEXT */
        .glitch-wrapper { position: relative; }
        .glitch::before, .glitch::after {
            content: attr(data-text); position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        }
        .glitch::before {
            left: 2px; text-shadow: -1px 0 #ff00c1; clip: rect(44px, 450px, 56px, 0);
            animation: glitch-anim 5s infinite linear alternate-reverse;
        }
        .glitch::after {
            left: -2px; text-shadow: -1px 0 #00fff9; clip: rect(44px, 450px, 56px, 0);
            animation: glitch-anim2 5s infinite linear alternate-reverse;
        }
        @keyframes glitch-anim {
            0% { clip: rect(30px, 9999px, 10px, 0); }
            100% { clip: rect(10px, 9999px, 100px, 0); }
        }
        @keyframes glitch-anim2 {
            0% { clip: rect(60px, 9999px, 10px, 0); }
            100% { clip: rect(10px, 9999px, 90px, 0); }
        }

        /* MAP & INPUT */
        .leaflet-container { background: #0a0a0f !important; }
        .leaflet-popup-content-wrapper, .leaflet-popup-tip { background: #0f172a; color: #fff; border: 1px solid #00f3ff; }
        input:focus, textarea:focus, select:focus { box-shadow: 0 0 15px rgba(0, 243, 255, 0.3); border-color: #00f3ff; outline: none; }

        /* VIEW TOGGLING */
        .view-section { display: none; opacity: 0; transition: opacity 0.3s ease; }
        .view-section.active { display: block; opacity: 1; }

        /* SIDEBAR */
        .sidebar-item:hover { background: linear-gradient(90deg, rgba(0, 243, 255, 0.1) 0%, transparent 100%); border-left: 2px solid #00f3ff; }
        .sidebar-item.active { background: linear-gradient(90deg, rgba(0, 243, 255, 0.15) 0%, transparent 100%); border-left: 2px solid #00f3ff; color: #fff; }
        
        /* RESULTS ANIMATION */
        .animate-enter { animation: fadeInUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    </style>
</head>
<body class="font-mono text-sm antialiased selection:bg-cyber-cyan selection:text-black flex flex-col h-screen overflow-hidden">

    <div class="scan-overlay"></div>

    <nav class="border-b border-cyber-border bg-cyber-dark/95 backdrop-blur-md fixed w-full z-50 h-16">
        <div class="flex items-center justify-between h-full px-6">
            <div class="flex items-center gap-3 w-64">
                <button onclick="document.getElementById('sidebar').classList.toggle('hidden')" class="md:hidden text-cyber-cyan hover:text-white">
                    <i class="fa-solid fa-bars text-xl"></i>
                </button>

                <i class="fa-solid fa-radar text-cyber-cyan animate-pulse-fast"></i>
                <span class="font-display font-bold text-xl tracking-widest text-white glitch-wrapper">
                    <span class="glitch" data-text="CYBER//OSINT">CYBER//OSINT</span>
                </span>
            </div>
            <div class="flex gap-6 text-xs text-cyber-cyan/70 items-center">
                <div class="hidden md:flex items-center gap-2">
                    <div class="w-2 h-2 rounded-full bg-cyber-cyan animate-pulse"></div>
                    SYSTEM ONLINE
                </div>
                <div class="border-l border-cyber-border pl-6">V.4.3.0</div>
            </div>
        </div>
    </nav>

    <div class="flex pt-16 h-full relative">

        <aside id="sidebar" class="w-64 bg-cyber-black border-r border-cyber-border hidden md:flex flex-col z-40 absolute md:relative h-full shadow-2xl">
            <div class="p-4">
                <button onclick="location.reload()" class="w-full bg-cyber-cyan text-black font-bold py-3 rounded hover:bg-white transition flex items-center justify-center gap-2">
                    <i class="fa-solid fa-plus"></i> NEW CASE
                </button>
            </div>

            <div class="flex-1 overflow-y-auto px-2 space-y-1">
                <div class="text-xs font-bold text-gray-500 px-4 py-2 mt-2">MODULES</div>
                <div onclick="switchView('dashboard')" id="nav-dashboard" class="sidebar-item active cursor-pointer px-4 py-3 text-gray-400 transition rounded flex items-center gap-3">
                    <i class="fa-solid fa-layer-group w-5"></i> Dashboard
                </div>
                <div onclick="switchView('heatmap')" id="nav-heatmap" class="sidebar-item cursor-pointer px-4 py-3 text-gray-400 transition rounded flex items-center gap-3">
                    <i class="fa-solid fa-border-all w-5"></i> Identity Heatmap
                </div>
                <div onclick="switchView('exif')" id="nav-exif" class="sidebar-item cursor-pointer px-4 py-3 text-gray-400 transition rounded flex items-center gap-3">
                    <i class="fa-solid fa-camera w-5"></i> EXIF Analyzer
                </div>
                <div onclick="switchView('utilities')" id="nav-utilities" class="sidebar-item cursor-pointer px-4 py-3 text-gray-400 transition rounded flex items-center gap-3">
                    <i class="fa-solid fa-toolbox w-5"></i> Utilities
                </div>

                <div class="text-xs font-bold text-gray-500 px-4 py-2 mt-4">ADVANCED OPS</div>
                <div onclick="switchView('social')" id="nav-social" class="sidebar-item cursor-pointer px-4 py-3 text-gray-400 transition rounded flex items-center gap-3">
                    <i class="fa-solid fa-users-viewfinder w-5"></i> Social Forensics
                </div>
                <div onclick="switchView('infrastructure')" id="nav-infrastructure" class="sidebar-item cursor-pointer px-4 py-3 text-gray-400 transition rounded flex items-center gap-3">
                    <i class="fa-solid fa-server w-5"></i> Infrastructure
                </div>

                <div class="text-xs font-bold text-gray-500 px-4 py-2 mt-6">CASES</div>
                <div class="sidebar-item cursor-pointer px-4 py-3 text-gray-400 transition rounded">
                    <div class="flex justify-between items-center">
                        <span>Case #8044</span> <span class="text-[10px] bg-cyber-border px-1 rounded">CLOSED</span>
                    </div>
                </div>
            </div>
        </aside>

        <main class="flex-1 overflow-y-auto bg-cyber-black relative p-6 md:p-8 w-full">

            <div id="view-dashboard" class="view-section active">

                <div id="searchSection" class="max-w-4xl mx-auto px-4 mt-10 transition-all duration-700">
                    <div class="text-center mb-12">
                        <h1 class="font-display text-5xl font-bold mb-4 text-transparent bg-clip-text bg-gradient-to-r from-cyber-cyan via-white to-cyber-cyan neon-text">TARGET ACQUISITION</h1>
                        <p class="text-gray-400 font-mono text-sm">Initiate deep-scan protocol on public identifiers.</p>
                    </div>

                    <div class="bg-cyber-panel border border-cyber-border rounded-xl p-6 shadow-lg neon-border backdrop-blur-sm">
                        <div class="mb-2 text-xs text-cyber-cyan font-bold uppercase tracking-widest border-b border-cyber-border/30 pb-2">Primary Identifiers (At least one required)</div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div class="flex items-center bg-cyber-black rounded-lg p-1 border border-cyber-border">
                                <i class="fa-solid fa-user text-gray-500 pl-3"></i>
                                <input type="text" id="usernameInput" placeholder="Enter Target Username" class="w-full bg-transparent border-none text-cyber-cyan p-2 font-mono">
                            </div>
                            <div class="flex items-center bg-cyber-black rounded-lg p-1 border border-cyber-border">
                                <i class="fa-solid fa-envelope text-gray-500 pl-3"></i>
                                <input type="email" id="emailInput" placeholder="target@example.com" class="w-full bg-transparent border-none text-cyber-cyan p-2 font-mono">
                            </div>
                            
                            <!-- UPDATED PHONE INPUT SECTION -->
                            <div class="flex items-center bg-cyber-black rounded-lg p-1 border border-cyber-border">
                                <select id="countryCode" class="bg-cyber-dark text-gray-400 border-none text-xs p-2 rounded-l focus:outline-none focus:ring-0">
                                    <option value="+91">üáÆüá≥ +91</option>
                                    <option value="+1">üá∫üá∏ +1</option>
                                    <option value="+44">üá¨üáß +44</option>
                                    <option value="+61">üá¶üá∫ +61</option>
                                    <option value="+86">üá®üá≥ +86</option>
                                    <option value="+971">üá¶üá™ +971</option>
                                    <option value="">üåê Any</option>
                                </select>
                                <input type="text" id="phoneInput" placeholder="Phone Number" class="w-full bg-transparent border-none text-cyber-cyan p-2 font-mono focus:outline-none focus:ring-0">
                            </div>
                        </div>

                        <div class="mb-2 text-xs text-gray-500 font-bold uppercase tracking-widest border-b border-cyber-border/30 pb-2 pt-2">Optional Context</div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="flex items-center bg-cyber-black rounded-lg p-1 border border-cyber-border">
                                <i class="fa-solid fa-id-card text-gray-500 pl-3"></i>
                                <input type="text" id="nameInput" placeholder="Full Name (Optional)" class="w-full bg-transparent border-none text-cyber-cyan p-2 font-mono">
                            </div>
                            <div class="flex items-center bg-cyber-black rounded-lg p-1 border border-cyber-border">
                                <i class="fa-solid fa-calendar text-gray-500 pl-3"></i>
                                <input type="text" id="dobInput" placeholder="DOB or Year (Optional)" class="w-full bg-transparent border-none text-cyber-cyan p-2 font-mono">
                            </div>
                        </div>

                        <p class="text-xs text-gray-500 mt-4 text-center"><i class="fa-solid fa-circle-info"></i> Tip: Provide at least one primary identifier. Name/DOB help filter results.</p>
                        <button onclick="initiateScan()" class="w-full bg-cyber-cyan/10 text-cyber-cyan border border-cyber-cyan/50 font-bold py-3 mt-4 rounded hover:bg-cyber-cyan/20 transition">INITIATE SCAN PROTOCOL</button>
                    </div>
                </div>

                <div id="terminalSection" class="hidden max-w-4xl mx-auto px-4 mt-8">
                    <div class="bg-black border border-cyber-border rounded-lg overflow-hidden shadow-2xl font-mono text-sm relative">
                        <div class="bg-cyber-panel px-4 py-2 border-b border-cyber-border flex justify-between">
                            <div class="flex gap-2"><div class="w-3 h-3 rounded-full bg-red-500"></div><div class="w-3 h-3 rounded-full bg-yellow-500"></div><div class="w-3 h-3 rounded-full bg-green-500"></div></div>
                            <div class="text-gray-500 text-xs">root@osint-node:~# ./scan.sh</div>
                        </div>
                        <div class="p-6 h-64 overflow-y-auto relative" id="terminalOutput">
                            <div class="text-green-500">[INIT] Initializing environment...</div>
                        </div>
                        <div class="absolute inset-0 pointer-events-none bg-gradient-to-b from-transparent via-cyber-cyan/5 to-transparent h-4 w-full animate-scanline opacity-30"></div>
                    </div>
                    <div class="mt-4 relative h-2 bg-cyber-dark rounded-full overflow-hidden border border-cyber-border">
                        <div id="progressBar" class="absolute top-0 left-0 h-full bg-cyber-cyan transition-all duration-300 w-0"></div>
                    </div>
                    <div class="flex justify-between mt-1 text-xs text-cyber-cyan font-mono"><span id="progressText">INITIALIZING...</span><span id="progressPercent">0%</span></div>
                </div>

                <div id="resultsSection" class="hidden max-w-7xl mx-auto px-4 mt-4 space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="bg-cyber-panel border border-cyber-border rounded-xl p-5"><div class="text-gray-400 text-xs mb-2">THREAT LEVEL</div><span id="riskLevelText" class="text-2xl font-bold text-cyber-red">CALCULATING</span><div class="w-full bg-gray-800 h-1 mt-2 rounded overflow-hidden"><div id="riskBar" class="h-full bg-cyber-red w-0"></div></div></div>
                        <div class="bg-cyber-panel border border-cyber-border rounded-xl p-5"><div class="text-gray-400 text-xs mb-2">IDENTITY MATCH</div><span id="confidenceVal" class="text-2xl font-bold text-cyber-cyan">0%</span><div class="w-full bg-gray-800 h-1 mt-2 rounded overflow-hidden"><div id="confBar" class="h-full bg-cyber-cyan w-0"></div></div></div>
                        <div class="bg-cyber-panel border border-cyber-border rounded-xl p-5"><div class="text-gray-400 text-xs mb-2">FOOTPRINT</div><span id="platformCountVal" class="text-2xl font-bold text-cyber-amber">0</span> ACCOUNTS</div>
                        <div class="bg-cyber-panel border border-cyber-border rounded-xl p-5"><div class="text-gray-400 text-xs mb-2">STATUS</div><span class="text-2xl font-bold text-green-400">COMPLETE</span></div>
                    </div>

                    <div class="bg-cyber-panel border border-cyber-border rounded-xl p-1 shadow-lg relative overflow-hidden">
                        <div class="absolute inset-0 bg-red-500/5 animate-pulse pointer-events-none"></div>
                        <div class="flex items-center justify-between px-6 py-4">
                            <div class="flex items-center gap-4">
                                <div class="bg-cyber-red/20 p-2 rounded text-cyber-red animate-pulse-fast"><i class="fa-brands fa-onion text-2xl"></i></div>
                                <div><h3 class="text-white font-bold tracking-widest text-sm">DARK WEB MONITOR</h3><p class="text-xs text-gray-400">Scanning HIBP & Darknet Indices</p></div>
                            </div>
                            <div class="text-right"><div class="text-cyber-red font-bold text-lg" id="breachCount">0 LEAKS DETECTED</div><div class="text-[10px] text-gray-500 font-mono">ID: <span id="monitorId">WAITING...</span></div></div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="lg:col-span-2 bg-cyber-panel border border-cyber-border rounded-xl p-5 shadow-lg flex flex-col min-h-[400px]">
                            <h3 class="text-cyber-cyan font-bold mb-4 border-b border-cyber-border pb-2">IDENTITY LINKAGE GRAPH</h3>
                            <div id="networkGraph" class="flex-1 w-full bg-[#050505] rounded border border-cyber-border/50 h-[320px]"></div>
                        </div>
                        <div class="bg-cyber-panel border border-cyber-border rounded-xl p-5 shadow-lg flex flex-col min-h-[400px]">
                            <h3 class="text-cyber-amber font-bold mb-4 border-b border-cyber-border pb-2">GEOLOCATION INTEL</h3>
                            <div id="map" class="flex-1 w-full rounded border border-cyber-border/50 z-10 h-[320px]"></div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <div class="bg-cyber-panel border border-cyber-border rounded-xl p-5"><h3 class="text-cyber-cyan font-bold mb-4">VECTORS</h3><div class="h-64"><canvas id="radarChart"></canvas></div></div>
                        <div class="bg-cyber-panel border border-cyber-border rounded-xl p-5"><h3 class="text-cyber-red font-bold mb-4">RISK</h3><div class="h-64"><canvas id="barChart"></canvas></div></div>
                        <div class="bg-cyber-panel border border-cyber-border rounded-xl p-5 flex flex-col">
                            <h3 class="text-cyber-amber font-bold mb-4">AI SENTIMENT & TOPICS</h3>
                            <div class="flex-1 flex flex-col justify-center space-y-4">
                                <div>
                                    <div class="flex justify-between text-xs text-gray-400 mb-1"><span>Aggression</span> <span>Low</span></div>
                                    <div class="w-full bg-gray-800 h-1.5 rounded"><div class="bg-green-400 h-full w-[10%]"></div></div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-xs text-gray-400 mb-1"><span>Tech-Focus</span> <span>High</span></div>
                                    <div class="w-full bg-gray-800 h-1.5 rounded"><div class="bg-cyber-cyan h-full w-[85%]"></div></div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-xs text-gray-400 mb-1"><span>Crypto-Risk</span> <span>Medium</span></div>
                                    <div class="w-full bg-gray-800 h-1.5 rounded"><div class="bg-amber-500 h-full w-[45%]"></div></div>
                                </div>
                                <div class="mt-4 p-3 bg-cyber-black rounded border border-cyber-border text-xs text-gray-400 italic">
                                    "Target appears to be a developer with interest in cloud infrastructure. No radicalization markers found."
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-cyber-panel border border-cyber-border rounded-xl p-5 shadow-lg flex flex-col">
                        <h3 class="text-cyber-amber font-bold mb-4 flex items-center gap-2">
                            <i class="fa-solid fa-id-card"></i> TARGET PROFILE & INTEL
                        </h3>
                        <div class="flex-1 bg-cyber-black rounded-lg p-4 font-mono text-xs text-gray-400 border border-cyber-border overflow-y-auto">
                            <div class="flex gap-4 mb-4">
                                <div class="w-16 h-16 bg-gray-800 rounded flex items-center justify-center border border-gray-700 overflow-hidden">
                                    <i class="fa-solid fa-user-secret text-3xl text-gray-600" id="profileIcon"></i>
                                    <img id="profileImage" src="" class="w-full h-full object-cover hidden">
                                </div>
                                <div class="flex-1">
                                    <div class="text-white font-bold text-sm mb-1">PRIMARY ALIAS</div>
                                    <div id="primaryAlias" class="text-cyber-cyan text-lg">UNKNOWN</div>
                                    <div class="mt-2 text-xs flex gap-4">
                                        <div><span class="text-gray-500">LOC:</span> <span id="detectedLoc" class="text-white">Analyzing...</span></div>
                                        <div><span class="text-gray-500">CAT:</span> <span id="usernameCategory" class="text-white">Unknown</span></div>
                                    </div>
                                </div>
                            </div>

                            <hr class="border-gray-800 my-4">

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="text-cyber-cyan font-bold mb-2 border-b border-gray-800 pb-1"><i class="fa-solid fa-envelope"></i> EMAIL INTELLIGENCE</h4>
                                    <ul class="space-y-1.5">
                                        <li class="flex justify-between"><span>Status:</span> <span id="emailStatus" class="text-gray-500">Not Scanned</span></li>
                                        <li class="flex justify-between"><span>Provider:</span> <span id="emailType" class="text-gray-500">N/A</span></li>
                                        <li class="flex justify-between"><span>Disposable:</span> <span id="emailDisposable" class="text-gray-500">Check Req</span></li>
                                        <li class="flex justify-between"><span>Breach Count:</span> <span id="emailBreach" class="text-gray-500">Unknown</span></li>
                                        <li class="flex justify-between"><span>Gravatar:</span> <span id="emailGravatar" class="text-gray-500">No</span></li>
                                        <li class="flex justify-between"><span>Malicious Domain:</span> <span id="emailMalicious" class="text-green-400">Clean</span></li>
                                        <li class="flex justify-between"><span>Deliverable:</span> <span id="emailDeliverable" class="text-green-400">Yes</span></li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="text-cyber-cyan font-bold mb-2 border-b border-gray-800 pb-1"><i class="fa-solid fa-phone"></i> PHONE INTELLIGENCE</h4>
                                    <ul class="space-y-1.5">
                                        <!-- NEW TRUE NAME FIELD -->
                                        <li class="flex justify-between items-center bg-cyber-dark p-1 rounded border border-cyber-border/50 mb-1">
                                            <span class="text-cyber-amber font-bold"><i class="fa-solid fa-id-badge"></i> TRUE NAME:</span>
                                            <span id="phoneTrueName" class="text-white font-bold flex items-center gap-1">
                                                Unknown
                                            </span>
                                        </li>
                                        <li class="flex justify-between"><span>Carrier:</span> <span id="phoneCarrier" class="text-gray-500">Not Scanned</span></li>
                                        <li class="flex justify-between"><span>Country:</span> <span id="phoneCountry" class="text-gray-500">N/A</span></li>
                                        <li class="flex justify-between"><span>Line Type:</span> <span id="phoneLine" class="text-gray-500">N/A</span></li>
                                        <li class="flex justify-between"><span>WhatsApp/TG:</span> <span id="phoneSocial" class="text-gray-500">Unknown</span></li>
                                        <li class="flex justify-between"><span>Spam Score:</span> <span id="phoneSpam" class="text-green-400">Low</span></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-cyber-panel border border-cyber-border rounded-xl p-5 shadow-lg">
                        <h3 class="text-cyber-cyan font-bold mb-4 border-b border-cyber-border pb-2">PATTERN OF LIFE ANALYSIS</h3>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-gray-400 text-xs mb-2">WEEKLY ACTIVITY FREQUENCY</h4>
                                <div class="h-48"><canvas id="activityChart"></canvas></div>
                            </div>
                            <div>
                                <h4 class="text-gray-400 text-xs mb-2">DIGITAL FOOTPRINT TIMELINE</h4>
                                <div class="space-y-3 max-h-48 overflow-y-auto pr-2 custom-scrollbar" id="timelineContainer">
                                    </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-cyber-panel border border-cyber-border rounded-xl overflow-hidden mt-6">
                        <div class="bg-cyber-dark/50 px-6 py-4 border-b border-cyber-border flex justify-between items-center">
                            <h3 class="text-white font-bold">DETECTED ARTIFACTS</h3>
                            <div class="flex gap-2">
                                <button onclick="exportCSV()" class="text-xs bg-cyber-border text-gray-400 px-3 py-1 rounded hover:text-white transition"><i class="fa-solid fa-file-csv"></i> CSV</button>
                                <button onclick="exportJSON()" class="text-xs bg-cyber-border text-gray-400 px-3 py-1 rounded hover:text-white transition"><i class="fa-solid fa-file-code"></i> JSON</button>
                                <button onclick="openReportModal()" class="text-xs bg-cyber-cyan/10 text-cyber-cyan px-3 py-1 rounded border border-cyber-cyan/20 hover:bg-cyber-cyan/20"><i class="fa-solid fa-file-pdf"></i> PDF REPORT</button>
                            </div>
                        </div>
                        <table class="w-full text-left text-sm text-gray-400 table-auto">
                            <thead class="bg-cyber-black text-xs uppercase font-medium text-gray-500">
                                <tr>
                                    <th class="px-6 py-3 whitespace-nowrap">Platform</th>
                                    <th class="px-6 py-3 whitespace-nowrap">Type</th>
                                    <th class="px-6 py-3 whitespace-nowrap">Resource Location (URL)</th>
                                    <th class="px-6 py-3 whitespace-nowrap">Confidence</th>
                                    <th class="px-6 py-3 text-right whitespace-nowrap">Action</th>
                                </tr>
                            </thead>
                            <tbody id="evidenceBody" class="divide-y divide-cyber-border font-mono text-xs"></tbody>
                        </table>
                        <div id="noEvidenceMsg" class="p-8 text-center text-gray-600 italic hidden">No artifacts detected.</div>
                    </div>
                </div>
            </div>

            <div id="view-heatmap" class="view-section">
                <h2 class="text-2xl font-bold text-cyber-cyan mb-6">IDENTITY AVAILABILITY HEATMAP</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4" id="heatmapGrid">
                    </div>
            </div>

            <div id="view-exif" class="view-section">
                <h2 class="text-2xl font-bold text-cyber-cyan mb-6">EXIF METADATA EXTRACTION</h2>
                <div class="bg-cyber-panel border-2 border-dashed border-cyber-border rounded-xl p-12 text-center hover:border-cyber-cyan transition cursor-pointer" id="dropZone">
                    <i class="fa-solid fa-cloud-arrow-up text-4xl text-gray-500 mb-4"></i>
                    <p class="text-gray-400">Drag & Drop Image or Click to Upload</p>
                    <input type="file" id="fileInput" class="hidden" accept="image/*">
                </div>
                <div id="exifResults" class="mt-8 hidden">
                    <h3 class="text-lg font-bold text-white mb-4">Extracted Data</h3>
                    <table class="w-full text-left text-sm text-gray-400 border border-cyber-border rounded">
                        <tbody id="exifTableBody" class="divide-y divide-cyber-border"></tbody>
                    </table>
                </div>
            </div>

            <div id="view-utilities" class="view-section">
                <h2 class="text-2xl font-bold text-cyber-cyan mb-6">INVESTIGATION UTILITIES</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-cyber-panel border border-cyber-border rounded-xl p-6">
                        <h3 class="text-white font-bold mb-4"><i class="fa-solid fa-users-gear text-cyber-amber"></i> ALIAS PERMUTATION ENGINE</h3>
                        <div class="space-y-3">
                            <input id="u_first" placeholder="Base Username / Name" class="w-full bg-cyber-black border border-cyber-border p-2 text-white rounded">
                            <input id="u_last" placeholder="Significant Number (e.g. Year)" class="w-full bg-cyber-black border border-cyber-border p-2 text-white rounded">
                            <input id="u_year" placeholder="Context Keyword (e.g. 'dev', 'gamer')" class="w-full bg-cyber-black border border-cyber-border p-2 text-white rounded">
                            <button onclick="generateUsernames()" class="w-full bg-cyber-border hover:bg-cyber-cyan/20 text-cyber-cyan py-2 rounded transition">GENERATE ALT ACCOUNTS</button>
                        </div>
                        <div id="usernameOutput" class="mt-4 p-3 bg-black rounded h-32 overflow-y-auto text-xs font-mono text-gray-400 hidden"></div>
                    </div>
                    <div class="bg-cyber-panel border border-cyber-border rounded-xl p-6">
                        <h3 class="text-white font-bold mb-4"><i class="fa-solid fa-ethernet text-cyber-red"></i> MAC OUI LOOKUP</h3>
                        <div class="flex gap-2">
                            <input id="macInput" placeholder="00:1A:2B:3C:4D:5E" class="flex-1 bg-cyber-black border border-cyber-border p-2 text-white rounded">
                            <button onclick="lookupMac()" class="bg-cyber-border hover:bg-cyber-red/20 text-cyber-red px-4 rounded transition">SEARCH</button>
                        </div>
                        <div id="macOutput" class="mt-4 text-cyber-cyan font-bold hidden"></div>
                    </div>
                    <div class="bg-cyber-panel border border-cyber-border rounded-xl p-6">
                        <h3 class="text-white font-bold mb-4"><i class="fa-solid fa-fingerprint text-cyber-cyan"></i> HASH IDENTIFIER</h3>
                        <div class="flex gap-2">
                            <input id="hashInput" placeholder="Paste Hash Here..." class="flex-1 bg-cyber-black border border-cyber-border p-2 text-white rounded">
                            <button onclick="identifyHash()" class="bg-cyber-border hover:bg-cyber-cyan/20 text-cyber-cyan px-4 rounded transition">IDENTIFY</button>
                        </div>
                        <div id="hashOutput" class="mt-4 text-green-400 font-bold hidden"></div>
                    </div>
                </div>
            </div>

            <div id="view-social" class="view-section">
                <h2 class="text-2xl font-bold text-cyber-cyan mb-6">SOCIAL FORENSICS</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-cyber-panel border border-cyber-border rounded-xl p-6">
                        <h3 class="text-white font-bold mb-4">FRIEND-OF-FRIEND MAPPER</h3>
                        <p class="text-gray-400 text-sm mb-4">Map indirect connections.</p>
                        <button onclick="alert('Module loading...')" class="w-full bg-cyber-cyan/10 text-cyber-cyan border border-cyber-cyan/50 py-2 rounded">LAUNCH GRAPH</button>
                    </div>
                    <div class="bg-cyber-panel border border-cyber-border rounded-xl p-6">
                        <h3 class="text-white font-bold mb-4">GAMING ALIAS HISTORY</h3>
                        <input placeholder="Steam ID / Discord ID" class="w-full bg-cyber-black border border-cyber-border p-2 text-white rounded mb-2">
                        <button class="w-full bg-cyber-border text-gray-400 py-2 rounded">SEARCH HISTORY</button>
                    </div>
                    <div class="bg-cyber-panel border border-cyber-border rounded-xl p-6">
                        <h3 class="text-white font-bold mb-4">RECOVERY ENUMERATION</h3>
                        <p class="text-gray-400 text-sm mb-4">Check linked masked emails via recovery.</p>
                        <button class="w-full bg-cyber-border text-gray-400 py-2 rounded">START ENUM</button>
                    </div>
                    <div class="bg-cyber-panel border border-cyber-border rounded-xl p-6">
                        <h3 class="text-white font-bold mb-4">LINKED CONTACTS DISCOVERY</h3>
                        <p class="text-gray-400 text-sm mb-4">Sync contacts simulation.</p>
                        <button class="w-full bg-cyber-border text-gray-400 py-2 rounded">RUN SYNC</button>
                    </div>
                </div>
            </div>

            <div id="view-infrastructure" class="view-section">
                <h2 class="text-2xl font-bold text-cyber-cyan mb-6">INFRASTRUCTURE RECON</h2>
                <div class="grid grid-cols-1 gap-6">
                    <div class="bg-cyber-panel border border-cyber-border rounded-xl p-6">
                        <h3 class="text-white font-bold mb-4">SUBDOMAIN & CLOUD SCANNER</h3>
                        <input placeholder="Target Domain (e.g. target.com)" class="w-full bg-cyber-black border border-cyber-border p-2 text-white rounded mb-2">
                        <button class="w-full bg-cyber-cyan/10 text-cyber-cyan border border-cyber-cyan/50 py-2 rounded">SCAN ASSETS</button>
                    </div>
                    <div class="bg-cyber-panel border border-cyber-border rounded-xl p-6">
                        <h3 class="text-white font-bold mb-4">GIT SECRETS INSPECTOR</h3>
                        <input placeholder="GitHub/GitLab Username" class="w-full bg-cyber-black border border-cyber-border p-2 text-white rounded mb-2">
                        <button class="w-full bg-cyber-border text-gray-400 py-2 rounded">SCAN COMMITS</button>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <div class="fixed bottom-0 left-0 w-full bg-cyber-black border-t border-cyber-border z-50 h-8 flex items-center px-4 font-mono text-[10px] text-gray-500">
        <div class="mr-4 text-cyber-cyan"><i class="fa-solid fa-terminal"></i> LIVE CONSOLE</div>
        <div id="liveLogFooter" class="flex-1 overflow-hidden whitespace-nowrap text-gray-400">System idle.</div>
    </div>

    <div id="reportModal" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-[60] hidden flex items-center justify-center">
        <div class="bg-cyber-panel border border-cyber-border p-6 rounded-xl w-96">
            <h3 class="text-xl font-bold text-white mb-4">Export Configuration</h3>
            <div class="space-y-2 mb-6">
                <label class="flex items-center gap-2 text-gray-300"><input type="checkbox" id="chkProfile" checked class="accent-cyber-cyan"> Include Target Profile</label>
                <label class="flex items-center gap-2 text-gray-300"><input type="checkbox" id="chkRisk" checked class="accent-cyber-cyan"> Include Risk Assessment</label>
                <label class="flex items-center gap-2 text-gray-300"><input type="checkbox" id="chkGeo" checked class="accent-cyber-cyan"> Include Geo-Data</label>
                <label class="flex items-center gap-2 text-gray-300"><input type="checkbox" id="chkGraph" checked class="accent-cyber-cyan"> Include Network Graph</label>
            </div>
            <div class="flex justify-end gap-3">
                <button onclick="document.getElementById('reportModal').classList.add('hidden')" class="px-4 py-2 text-gray-400 hover:text-white">Cancel</button>
                <button onclick="generatePDF()" class="bg-cyber-cyan text-black font-bold px-4 py-2 rounded hover:bg-white transition">Download PDF</button>
            </div>
        </div>
    </div>

    <script>
        // --- GLOBAL VARIABLES ---
        let mapInstance = null;
        let networkInstance = null;
        let radarChartInstance = null;
        let barChartInstance = null;
        let activityChartInstance = null;
        let currentScanData = null; // Store scan data

        // --- HELPER: SAFE PROPERTY ACCESS ---
        const getVal = (obj, path, def) => {
            return path.split('.').reduce((o, p) => (o ? o[p] : def), obj);
        };

        // GLOBAL INPUT STORAGE
        let globalInputs = { username: "", email: "", phone: "", name: "", dob: "" };

        // --- NAVIGATION ---
        function switchView(viewId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.sidebar-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`view-${viewId}`).classList.add('active');

            const navItem = document.getElementById(`nav-${viewId}`);
            if(navItem) navItem.classList.add('active');

            if(window.innerWidth < 768) {
                document.getElementById('sidebar').classList.add('hidden');
            }

            if(viewId === 'heatmap') renderHeatmap();
        }

        // --- DASHBOARD LOGIC ---
        let logs = [
            "Initializing OSINT modules...", "Loading proxy configurations...", "Connecting to public registry nodes...",
            "Handshake successful [Node: Alpha-7]", "Scraping social indices...", "Parsing username variations...",
            "Cross-referencing email patterns...", "Checking HIBP breach datasets...", "Analyzing Gravatar hashes...",
            "Triangulating digital footprint...", "Correlating identity vectors...", "Generating risk heuristics...",
            "Compiling evidence artifacts...", "Finalizing report object..."
        ];
        let liveLogs = ["Packet captured...", "DNS lookup success...", "API Rate Limit OK...", "Analyzing headers...", "Scanning ports...", "Handshake verify..."];

        function startLiveLogs() {
            setInterval(() => {
                document.getElementById('liveLogFooter').innerText = `[${new Date().toLocaleTimeString()}] ${liveLogs[Math.floor(Math.random()*liveLogs.length)]}`;
            }, 2000);
        }
        startLiveLogs();

        async function initiateScan() {
            const u = document.getElementById('usernameInput').value;
            const e = document.getElementById('emailInput').value;
            
            // COMBINE COUNTRY CODE AND PHONE
            const country = document.getElementById('countryCode').value;
            const phoneRaw = document.getElementById('phoneInput').value;
            let p = "";
            if (phoneRaw) {
                // Remove non-numeric characters and prepend country code
                p = country + phoneRaw.replace(/\D/g, ''); 
            }
            
            const n = document.getElementById('nameInput').value;
            const dob = document.getElementById('dobInput').value;

            // Store Globally
            globalInputs = { username: u, email: e, phone: p, name: n, dob: dob };

            if(!u && !e && !p) {
                alert("ERR: INPUT_MISSING. Please provide at least one PRIMARY identifier (Username, Email, or Phone).");
                return;
            }

            document.getElementById('searchSection').classList.add('hidden');
            document.getElementById('terminalSection').classList.remove('hidden');

            const term = document.getElementById('terminalOutput');
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressPercent');

            const apiPromise = fetch("/run_osint", {
                method: "POST",
                headers:{"Content-Type":"application/json"},
                body: JSON.stringify(globalInputs)
            })
            .then(r => r.json())
            .catch(err => {
                console.error(err);
                return null;
            });

            let progress = 0;
            let logIndex = 0;
            let apiFinished = false;
            let resultData = null;

            apiPromise.then(data => {
                apiFinished = true;
                resultData = data;
            });

            const interval = setInterval(async () => {
                if (apiFinished) {
                    progress = 100;
                    progressBar.style.width = `100%`;
                    progressText.innerText = `100%`;

                    if (term.lastChild.innerText !== "> Scan Complete.") {
                         const div = document.createElement('div');
                         div.className = "mb-1 text-green-400 font-bold";
                         div.innerText = "> Scan Complete.";
                         term.appendChild(div);
                         term.scrollTop = term.scrollHeight;
                    }

                    clearInterval(interval);
                    await new Promise(r => setTimeout(r, 1000));

                    if (resultData) {
                        showResults(resultData);
                    } else {
                        alert("Scan failed or returned empty data.");
                        location.reload();
                    }
                    return;
                }

                let increment = 1;
                if (progress > 50) increment = 0.5;
                if (progress > 80) increment = 0.2;
                if (progress > 90) increment = 0.05;

                if (progress >= 95 && !apiFinished) {
                    increment = 0;
                    progress = 95;
                } else {
                    progress += increment;
                }

                progressBar.style.width = `${progress}%`;
                progressText.innerText = `${Math.floor(progress)}%`;

                const targetLogIndex = Math.floor((progress / 95) * logs.length);
                if (targetLogIndex > logIndex && logIndex < logs.length) {
                    const div = document.createElement('div');
                    div.className = "mb-1 text-gray-300";
                    div.innerText = `> ${logs[logIndex]}`;
                    term.appendChild(div);
                    term.scrollTop = term.scrollHeight;
                    logIndex++;
                }

            }, 100);
        }

        function showResults(data) {
            currentScanData = data;

            // Hide Terminal, Show Results
            document.getElementById('terminalSection').classList.add('hidden');
            const resSection = document.getElementById('resultsSection');
            resSection.classList.remove('hidden');
            
            // Trigger Animation
            resSection.classList.remove('animate-enter');
            void resSection.offsetWidth; // Trigger reflow
            resSection.classList.add('animate-enter');

            // 1. PROFILE
            const u = globalInputs.username || "Unknown";
            document.getElementById('primaryAlias').innerText = u;
            document.getElementById('detectedLoc').innerText = getVal(data, 'profiles.GitHub.location', 'Unknown');


            let cat = "General User";
            if(getVal(data, 'username_results.GitHub.found', false)) cat = "Developer";
            else if(getVal(data, 'username_results.Steam.found', false)) cat = "Gamer";
            else if(getVal(data, 'username_results.LinkedIn.found', false)) cat = "Professional";
            document.getElementById('usernameCategory').innerText = cat;

            // Email Intel
            const e = globalInputs.email;
            if(getVal(data, 'email_results.valid', false)) {
                document.getElementById('emailStatus').innerText = "Valid";
                document.getElementById('emailStatus').className = "text-green-400";
                document.getElementById('emailType').innerText = getVal(data, 'email_results.provider', 'Standard');
                document.getElementById('emailBreach').innerText = "Safe (Mock)";
                document.getElementById('emailDisposable').innerText = "No";
                document.getElementById('emailGravatar').innerText = getVal(data, 'email_results.gravatar.exists', false) ? "Found" : "No";
            } else {
                document.getElementById('emailStatus').innerText = "Not Scanned";
                document.getElementById('emailType').innerText = "N/A";
                document.getElementById('emailDisposable').innerText = "-";
            }

            // Phone Intel (FIXED SECTION)
            if(getVal(data, 'phone_results.valid', false)) {
                const p = data.phone_results;
                // Reading nested data from phone_osint.py structure
                document.getElementById('phoneCarrier').innerText = getVal(p, 'basic.carrier', 'Unknown');
                document.getElementById('phoneCountry').innerText = getVal(p, 'basic.country', 'International');
                document.getElementById('phoneLine').innerText = getVal(p, 'basic.line_type', 'Mobile/Cellular');
                
                // TRUE NAME
                const cnam = getVal(p, 'identity.cnam', 'Private');
                const trueNameEl = document.getElementById('phoneTrueName');
                if(cnam !== "Private" && cnam !== "Unknown") {
                    trueNameEl.innerHTML = `${cnam} <i class="fa-solid fa-circle-check text-blue-400 ml-1"></i>`;
                    trueNameEl.className = "text-white font-bold flex items-center gap-1";
                } else {
                    trueNameEl.innerText = "Private / Unlisted";
                    trueNameEl.className = "text-gray-500 font-normal";
                }

                // Social Links
                const wa = getVal(p, 'dorks.WhatsApp API', '#');
                document.getElementById('phoneSocial').innerHTML = `<a href="${wa}" target="_blank" class="text-cyber-cyan hover:underline">Check WhatsApp</a>`;
                document.getElementById('phoneSpam').innerText = getVal(p, 'identity.spam_score', 'Low');
            } else {
                document.getElementById('phoneCarrier').innerText = "Not Scanned";
                document.getElementById('phoneCountry').innerText = "N/A";
                document.getElementById('phoneTrueName').innerText = "-";
            }

            // 2. KPI
            const riskLevel = getVal(data, 'risk.level', 'LOW');
            document.getElementById('riskLevelText').innerText = riskLevel;

            const riskScore = Math.min(getVal(data, 'risk.risk_score', 0), 100);
            document.getElementById('riskBar').style.width = `${riskScore}%`;

            const conf = getVal(data, 'identity_confidence.confidence_score', 0);
            document.getElementById('confidenceVal').innerText = `${conf}%`;
            document.getElementById('confBar').style.width = `${conf}%`;

            const uRes = data.username_results || {};
            const found = Object.values(uRes).filter(x=>x.found);
            document.getElementById('platformCountVal').innerText = found.length;

            // 3. TABLE
            const tbody = document.getElementById('evidenceBody');
            tbody.innerHTML = "";
            if (found.length === 0) {
                document.getElementById('noEvidenceMsg').classList.remove('hidden');
            } else {
                document.getElementById('noEvidenceMsg').classList.add('hidden');
                found.forEach(f => {
                    const iconClass = f.category ? `fa-${f.category.toLowerCase()}` : 'fa-link';
                    tbody.innerHTML += `
                        <tr class="hover:bg-cyber-dark/50 transition duration-150 group border-b border-cyber-border/50">
                            <td class="px-6 py-4 font-medium text-white flex items-center gap-2 whitespace-nowrap">
                                <i class="fa-brands ${iconClass} text-gray-500 group-hover:text-cyber-cyan transition"></i> ${f.category || 'Unknown'}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-gray-400">Profile</td>
                            <td class="px-6 py-4 text-cyber-cyan truncate max-w-xs cursor-pointer hover:underline" onclick="window.open('${f.url}','_blank')">${f.url}</td>
                            <td class="px-6 py-4 whitespace-nowrap"><span class="bg-green-900/30 text-green-400 px-2 py-1 rounded text-[10px] border border-green-800">HIGH</span></td>
                            <td class="px-6 py-4 text-right whitespace-nowrap">
                                <button class="text-gray-500 hover:text-white"><i class="fa-solid fa-up-right-from-square"></i></button>
                            </td>
                        </tr>`;
                });
            }

            // 4. CHARTS/MAPS
            initCharts(data, found.length);
            initMap(data);
            initNetwork(data);
            initActivityChart(data.activity_stats); // PASS REAL STATS
            populateTimeline(data.timeline);
        }

        function initCharts(data, count) {
            if(radarChartInstance) radarChartInstance.destroy();
            if(barChartInstance) barChartInstance.destroy();

            // USE REAL DATA FOR RADAR
            const stats = data.radar_stats || { Social: 0, Dev: 0, Contact: 0, Breach: 0, Geo: 0 };

            radarChartInstance = new Chart(document.getElementById('radarChart'), {
                type: 'radar',
                data: {
                    labels: ['Social', 'Dev', 'Contact', 'Breach', 'Geo'],
                    datasets: [{
                        label: 'Target',
                        data: [stats.Social, stats.Dev, stats.Contact, stats.Breach, stats.Geo],
                        borderColor: '#00f3ff',
                        backgroundColor: 'rgba(0,243,255,0.2)',
                        borderWidth: 2,
                        pointBackgroundColor: '#fff'
                    }]
                },
                options: {
                    scales: {
                        r: {
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { display: false, backdropColor: 'transparent' },
                            pointLabels: { color: '#9ca3af', font: { size: 10, family: '"JetBrains Mono", monospace' } }
                        }
                    },
                    plugins: { legend: { display: false } }
                }
            });

            barChartInstance = new Chart(document.getElementById('barChart'), {
                type: 'bar',
                data: {
                    labels: ['Username', 'Email', 'Phone'],
                    datasets: [{
                        data: [count*15, getVal(data, 'email_results.valid', false) ? 50 : 0, getVal(data, 'phone_results.valid', false) ? 50 : 0],
                        backgroundColor: ['#ff2a2a', '#ffb800', '#00f3ff']
                    }]
                },
                options: {
                    scales: { x: { display: false }, y: { grid: { color: '#333' } } },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // UPDATED: Now accepts real data argument
        function initActivityChart(stats) {
            if(activityChartInstance) activityChartInstance.destroy();
            
            // Use real stats if provided, otherwise default to a flat line (not random)
            const chartData = stats && stats.length === 7 ? stats : [0,0,0,0,0,0,0];

            const ctx = document.getElementById('activityChart').getContext('2d');
            activityChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Activity Events',
                        data: chartData,
                        backgroundColor: '#00f3ff',
                        borderRadius: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { display: false },
                        x: { grid: { display: false }, ticks: { color: '#6b7280' } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        function populateTimeline(timelineData) {
            const container = document.getElementById('timelineContainer');
            container.innerHTML = "";

            // USE REAL DATA
            const events = timelineData || [];

            if (events.length === 0) {
                container.innerHTML = `<div class="text-gray-500 text-xs italic text-center py-4">No timeline events detected.</div>`;
                return;
            }

            events.forEach(e => {
                container.innerHTML += `
                    <div class="flex gap-4 group">
                        <div class="text-cyber-cyan font-bold w-12 text-right">${e.year}</div>
                        <div class="border-l-2 border-cyber-border pl-4 pb-2 relative flex-1">
                            <div class="absolute w-2 h-2 bg-cyber-amber rounded-full -left-[5px] top-1.5 group-hover:shadow-[0_0_8px_#ffb800] transition"></div>
                            <div class="text-gray-300 text-sm font-bold">${e.event}</div>
                            <div class="text-gray-500 text-[10px] mt-0.5">${e.details || ''}</div>
                        </div>
                    </div>
                `;
            });
        }

        async function initMap(data) {
            if (mapInstance) { mapInstance.off(); mapInstance.remove(); }
            mapInstance = L.map('map', { zoomControl:false }).setView([20,0], 2);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(mapInstance);

            let locationQuery = null;
            let source = "Unknown";

            if(data.profiles && data.profiles.GitHub && data.profiles.GitHub.location) {
                locationQuery = data.profiles.GitHub.location;
                source = "GitHub";
            }

            if (locationQuery) {
                try {
                    const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(locationQuery)}`);
                    const results = await response.json();
                    if (results && results.length > 0) {
                        const lat = results[0].lat;
                        const lon = results[0].lon;
                        mapInstance.setView([lat, lon], 10);
                        L.circleMarker([lat, lon], { color:'#00f3ff', radius:8 }).addTo(mapInstance)
                            .bindPopup(`<b>Signal Detected (${source})</b><br>${results[0].display_name}`).openPopup();
                    }
                } catch (e) {
                    console.error("Geocoding error", e);
                }
            }
        }

        function initNetwork(data) {
            const nodes = [{id:0, label:"TARGET", color:"#ffb800", size:30}];
            const edges = [];
            let i=1;
            const uRes = data.username_results || {};
            Object.keys(uRes).forEach(k => {
                if(uRes[k].found) {
                    nodes.push({id:i, label:k, color:"#00f3ff", shape:"dot"});
                    edges.push({from:0, to:i});
                    i++;
                }
            });
            if(networkInstance) networkInstance.destroy();
            const container = document.getElementById('networkGraph');
            networkInstance = new vis.Network(container, {nodes, edges}, {
                nodes: { font:{color:"#fff"} },
                physics: { stabilization: true },
                interaction: { dragNodes: false, dragView: false, zoomView: false }
            });
        }

        // --- HEATMAP ---
        function renderHeatmap() {
            const grid = document.getElementById('heatmapGrid');
            grid.innerHTML = "";
            if (!currentScanData) {
                grid.innerHTML = `<div class="col-span-full text-center text-gray-500 py-10 italic">Awaiting Scan Data... Please run a scan from the Dashboard first.</div>`;
                return;
            }
            const sites = ["Facebook", "Twitter", "Instagram", "LinkedIn", "GitHub", "Pinterest", "Reddit", "Twitch", "Steam", "Discord", "Spotify", "Medium", "Vimeo", "SoundCloud", "Slack", "Trello", "Airbnb", "Ebay", "Amazon", "Netflix", "Hulu", "PayPal", "Venmo", "CashApp"];
            sites.forEach(site => {
                let found = currentScanData.username_results[site] && currentScanData.username_results[site].found;
                grid.innerHTML += `
                    <div class="bg-cyber-panel border ${found ? 'border-green-500/50' : 'border-cyber-border'} p-4 rounded text-center opacity-80 hover:opacity-100 transition relative overflow-hidden">
                        <div class="absolute inset-0 ${found ? 'bg-green-500/10' : ''}"></div>
                        <i class="fa-brands fa-${site.toLowerCase().replace(' ', '')} text-2xl mb-2 ${found ? 'text-green-400' : 'text-gray-600'}"></i>
                        <div class="text-xs text-white font-bold relative z-10">${site}</div>
                        <div class="text-[10px] mt-1 relative z-10 ${found ? 'text-green-400 font-bold' : 'text-gray-600'}">${found ? 'DETECTED' : 'NOT FOUND'}</div>
                    </div>
                `;
            });
        }

        // --- EXIF TOOL ---
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        dropZone.onclick = () => fileInput.click();
        dropZone.ondragover = (e) => { e.preventDefault(); dropZone.classList.add('border-cyber-cyan'); };
        dropZone.ondragleave = () => dropZone.classList.remove('border-cyber-cyan');
        dropZone.ondrop = (e) => { e.preventDefault(); handleFile(e.dataTransfer.files[0]); };
        fileInput.onchange = (e) => handleFile(e.target.files[0]);

        function handleFile(file) {
            if(!file) return;
            EXIF.getData(file, function() {
                const data = EXIF.getAllTags(this);
                const tbody = document.getElementById('exifTableBody');
                tbody.innerHTML = "";
                document.getElementById('exifResults').classList.remove('hidden');
                const keys = ["Make", "Model", "DateTime", "GPSLatitude", "GPSLongitude"];
                keys.forEach(k => {
                    let val = data[k] || "Not Found";
                    if(typeof val === 'object' && val.length) val = val[0] + " deg";
                    tbody.innerHTML += `<tr><td class="px-4 py-2 border-r border-cyber-border text-cyber-cyan">${k}</td><td class="px-4 py-2">${val}</td></tr>`;
                });
                tbody.innerHTML += `<tr><td class="px-4 py-2 border-r border-cyber-border text-cyber-cyan">FileName</td><td class="px-4 py-2">${file.name}</td></tr>`;
                tbody.innerHTML += `<tr><td class="px-4 py-2 border-r border-cyber-border text-cyber-cyan">Size</td><td class="px-4 py-2">${(file.size/1024).toFixed(2)} KB</td></tr>`;
            });
        }

        // --- EXPORT FUNCTIONS ---
        function exportCSV() {
            if(!currentScanData) return alert("No data to export.");
            let csv = "Platform,URL,Confidence\n";
            Object.values(currentScanData.username_results).forEach(r => {
                if(r.found) csv += `${r.category},${r.url},High\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'osint_data.csv'; a.click();
        }

        function exportJSON() {
            if(!currentScanData) return alert("No data to export.");
            const blob = new Blob([JSON.stringify(currentScanData, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'osint_data.json'; a.click();
        }

        // --- UTILITIES ---
        function generateUsernames() {
            const f = document.getElementById('u_first').value.toLowerCase();
            const l = document.getElementById('u_last').value.toLowerCase();
            const y = document.getElementById('u_year').value;
            const output = document.getElementById('usernameOutput');
            output.innerHTML = "";
            output.classList.remove('hidden');
            if(!f || !l) { output.innerHTML = "Enter Base and Context."; return; }
            const list = [`${f}${l}`, `${f}.${l}`, `${f}_${l}`, `${l}${f}`, `${l}.${f}`, `${f}${l}${y}`, `${f}.${l}${y}`, `${f}${y}`, `${l}${y}`, `${f.charAt(0)}${l}`];
            list.forEach(u => output.innerHTML += `${u}<br>`);
        }

        function lookupMac() {
            const mac = document.getElementById('macInput').value;
            const out = document.getElementById('macOutput');
            out.classList.remove('hidden');
            const vendors = {"00:1A:2B": "Cisco Systems", "00:0C:29": "VMware", "F0:98:9D": "Apple", "B8:27:EB": "Raspberry Pi"};
            const prefix = mac.substring(0,8).toUpperCase();
            out.innerText = vendors[prefix] || "Vendor Not Found in Local DB";
        }

        function identifyHash() {
            const h = document.getElementById('hashInput').value;
            const out = document.getElementById('hashOutput');
            out.classList.remove('hidden');
            if(h.length === 32) out.innerText = "MD5";
            else if(h.length === 40) out.innerText = "SHA-1";
            else if(h.length === 64) out.innerText = "SHA-256";
            else out.innerText = "Unknown Format";
        }

        function openReportModal() { document.getElementById('reportModal').classList.remove('hidden'); }
        function generatePDF() {
            const doc = new window.jspdf.jsPDF();
            doc.setFont("courier");
            doc.text("CONFIDENTIAL INTELLIGENCE REPORT", 10, 20);
            doc.text("Generated: " + new Date().toLocaleString(), 10, 30);
            doc.text("Subject: " + (document.getElementById('usernameInput').value || "UNKNOWN"), 10, 40);
            if(document.getElementById('chkProfile').checked) doc.text("[x] Target Profile Included", 10, 50);
            if(document.getElementById('chkRisk').checked) doc.text("[x] Risk Assessment Included", 10, 60);
            if(document.getElementById('chkGeo').checked) doc.text("[x] Geo-Data Included", 10, 70);
            doc.save("OSINT_Report.pdf");
            document.getElementById('reportModal').classList.add('hidden');
        }
    </script>
</body>
</html>